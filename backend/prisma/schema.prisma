generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  EMPLOYEE
  CLIENT
}
enum ProjectStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id                 String         @id @default(uuid())
  name               String
  email              String         @unique
  password           String
  role               Role
  isActive           Boolean        @default(true)
  clientCompanyId    String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  clientCompany      ClientCompany? @relation(fields: [clientCompanyId], references: [id])
  assignments        ProjectEmployee[]
  sentMessages       Message[]      @relation("sender")
  receivedMessages   Message[]      @relation("receiver")
}

model Service {
  id             String          @id @default(uuid())
  name           String
  description    String?
  price          Decimal         @db.Decimal(10, 2)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  serviceRequests ServiceRequest[]
}

model ServiceRequest {
  id        String        @id @default(uuid())
  clientId  String
  serviceId String
  status    RequestStatus @default(PENDING)
  details   String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  client    ClientCompany @relation(fields: [clientId], references: [id])
  service   Service       @relation(fields: [serviceId], references: [id])
  createdBy String?
}

model ClientCompany {
  id              String           @id @default(uuid())
  name            String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  users           User[]
  projects        Project[]
  serviceRequests ServiceRequest[]
}

model Project {
  id          String        @id @default(uuid())
  name        String
  description String?
  clientId    String
  status      ProjectStatus @default(NOT_STARTED)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  client      ClientCompany @relation(fields: [clientId], references: [id])
  assignments ProjectEmployee[]
  @@index([clientId, status])
}

model ProjectEmployee {
  id         String   @id @default(uuid())
  projectId  String
  employeeId String
  assignedAt DateTime @default(now())
  project    Project  @relation(fields: [projectId], references: [id])
  employee   User     @relation(fields: [employeeId], references: [id])
  @@unique([projectId, employeeId])
  @@index([employeeId])
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  receiverId String
  content    String
  createdAt  DateTime @default(now())
  sender     User     @relation("sender", fields: [senderId], references: [id])
  receiver   User     @relation("receiver", fields: [receiverId], references: [id])
  @@index([senderId, receiverId])
}
